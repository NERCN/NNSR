# 离线分析系统

离线分析系统是NNSR的核心组件之一，专门用于对已采集的DBS局部场电位（LFP）数据进行处理与分析。该系统提供从数据导入到结果输出的完整分析流程。

## 系统概述

### 主要功能模块

离线分析系统包含四个核心模块：

1. **数据管理**：数据导入、解析和格式转换
2. **数据预处理**：伪迹识别与去除
3. **特征分析**：多维特征提取与计算
4. **结果输出**：数据可视化与报告生成

### 工作流程

```
数据导入 → 预处理 → 特征提取 → 结果分析 → 报告生成
```

## 数据管理模块

### 数据导入功能

#### 支持的数据格式
- **原生格式**：清华可感知脑起搏器.dat/.data文件
- **通用格式**：TXT文件、.mat文件（或percept pc转码）

#### 导入操作步骤
1. 点击"LFP数据选择"按钮
2. 在文件浏览器中选择目标数据文件
3. 系统自动解析文件并显示数据列表
4. 选择需要分析的数据段
5. 点击"数据确认"完成导入

### 数据管理功能

#### 文件信息显示
- **采样参数**：采样率、通道数、数据长度
- **设备信息**：设备型号、固件版本
- **患者信息**：ID和基本参数

## 数据预处理模块

### 基线漂移校正

#### 高通滤波法
- **滤波器类型**：IIR、FIR滤波器可选
- **设计方法**：Butterworth、Chebyshev等
- **参数设置**：截止频率、阶数、纹波系数
- **实时预览**：滤波器频响特性曲线显示

#### 多项式拟合法
- **拟合阶数**：1-10阶多项式可选
- **分段处理**：支持分段拟合去除趋势
- **鲁棒性选项**：抗异常值的鲁棒拟合

### 刺激伪迹去除

#### 滤波器方法
- **低通滤波**：去除高频刺激伪迹
- **陷波滤波**：针对特定频率的刺激信号
- **自适应滤波**：根据刺激参数自动配置

#### 模板匹配法
- **模板提取**：自动识别刺激脉冲模板
- **模板匹配**：基于相关性的模板匹配
- **伪迹减除**：从原信号中减去估计的伪迹

### 心电伪迹去除

#### EAS（Enhanced Adaptive Subtraction）方法
- **心电检测**：自动检测心电信号
- **模板构建**：构建平均心电模板
- **自适应减除**：自适应减除心电伪迹

#### 参数配置
- **处理步长**：心电模板提取的时间窗
- **参考心电**：可选择外部心电参考信号
- **去除分段**：设置处理的最小时间单元

### 预处理质量控制

#### 处理效果评估
- **频谱对比**：处理前后功率谱对比
- **时域对比**：时域波形的直观对比

#### 参数优化建议
- **自动参数推荐**：推荐默认参数
- **效果预测**：预测不同参数组合的处理效果

## 特征分析模块

### 功率谱分析

#### Welch方法
- **窗函数选择**：Hamming、Hann、Blackman等
- **窗长设置**：可配置的时间窗长度
- **重叠度**：窗间重叠百分比设置
- **FFT点数**：零填充长度配置

#### 直接FFT方法
- **快速计算**：适用于长时间序列
- **频率分辨率**：可调节的频率分辨率
- **频段分析**：预定义频段的能量计算

### 时频分析

#### 短时傅里叶变换（STFT）
- **时间分辨率**：可调节的时间窗长度
- **频率分辨率**：通过窗长平衡时频分辨率
- **重叠设置**：时间窗重叠参数

#### 连续小波变换（CWT）
- **母小波选择**：Morlet等
- **尺度范围**：对应分析的频率范围
- **时频图绘制**：高质量的时频能量分布图

### 相位特征分析

#### 相位谱计算
- **相位提取**：基于Hilbert变换或FFT
- **相位包络**：瞬时相位的计算
- **相位-频率图**：相位随频率的变化

#### 相位锁定值（PLV）
- **通道间同步性**：计算多通道间的相位同步
- **时间演化**：PLV随时间的动态变化
- **频段特异性**：特定频段的同步性分析

## 结果输出模块

### 可视化输出

#### 图形生成
- **多子图布局**：灵活的图形布局配置
- **高质量图像**：矢量图和位图格式输出
- **自定义样式**：颜色、字体、标注的个性化设置

#### 交互式图表
- **缩放平移**：图像的交互式操作
- **数据标注**：手动添加标注和说明
- **参数调整**：实时调整显示参数

### 数据导出

#### 处理后数据
- **MAT格式**：MATLAB工作空间兼容
- **EDF格式**：标准生理信号格式
- **CSV格式**：通用数据交换格式

#### 分析结果
- **特征矩阵**：提取的特征值表格
- **统计报告**：描述性统计和显著性检验
- **参数记录**：完整的处理参数记录

### 批量处理

#### 自动化流程
- **批量导入**：一次性处理多个文件
- **统一参数**：应用相同的处理流程
- **进度监控**：实时显示处理进度

#### 结果汇总
- **统计汇总**：跨文件的统计分析
- **对比分析**：不同条件下的对比
- **趋势分析**：时间序列的趋势检测

### 常见应用场景
- **临床研究**：疾病特征的电生理标志物分析
- **算法验证**：新算法的性能测试和对比
- **数据探索**：大规模数据的初步探索分析

通过离线分析系统，研究人员可以高效、准确地处理DBS电生理数据，为临床研究和科学探索提供可靠的分析工具。

