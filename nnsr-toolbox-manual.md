# NNSR Toolbox 用户说明书

## 目录

- [1. 简介](#1-简介)
- [2. 安装指南](#2-安装指南)
- [3. 软件功能概述](#3-软件功能概述)
- [4. 离线分析系统](#4-离线分析系统)
- [5. 在线分析系统](#5-在线分析系统)
- [6. 应用场景](#6-应用场景)
- [7. 常见问题与故障排除](#7-常见问题与故障排除)
- [8. 技术支持](#8-技术支持)

## 1. 简介

### 1.1 软件概述

NERCN NeuroSignal Research (NNSR) Toolbox 是一款专为脑深部电刺激(Deep Brain Stimulation, DBS)感知信号分析而设计的综合软件平台。该工具基于MATLAB环境开发，集成了离线分析和在线分析两大核心功能模块，旨在为神经科学研究人员和临床医生提供一套完整的电生理数据处理与分析解决方案。

NNSR Toolbox能够有效处理来自全植入式DBS设备的局部场电位(Local Field Potential, LFP)数据，包括伪迹识别与处理、特征提取、实时监测等功能，为脑深部电信号分析与脑机交互研究提供强大的技术支持。

### 1.2 主要特性

- **用户友好的图形界面**：直观的操作流程设计，降低神经电生理数据分析的技术门槛
- **多功能伪迹处理**：自动识别并处理基线漂移、心电伪迹、电脉冲伪迹和体动伪迹
- **全面的特征提取**：支持时域、频域、时频域和时相特征的提取与分析
- **实时数据分析**：提供低延迟的在线分析和实时反馈功能
- **安全可靠**：配备专用安全协议，确保设备交互的安全性
- **可扩展性**：模块化设计便于功能扩展和自定义分析

### 1.3 适用范围

NNSR Toolbox主要适用于：
- 脑深部电刺激临床研究及治疗
- 帕金森病、震颤、肌张力障碍及其他神经精神疾病的电生理研究
- 脑机接口与神经调控机制探索
- 个性化神经调控治疗方案的开发与评估

## 2. 安装指南

### 2.1 系统要求

- **操作系统**：Windows 10/11 (64位)
- **处理器**：Intel Core i5或更高
- **内存**：≥8GB RAM (建议16GB以上)
- **硬盘空间**：≥10GB可用空间
- **显示**：最低1920×1080分辨率
- **软件环境**：
  - 独立应用版无需额外软件环境
  - MATLAB版需要MATLAB 2023b或更高版本

### 2.2 安装步骤

1. **下载安装包**：从官方网站下载最新版NNSR Toolbox安装包

2. **独立应用版安装**：
   - 双击安装程序运行
   - 按照安装向导提示操作
   - 选择安装位置，建议使用默认路径
   - 完成安装后，桌面将创建快捷方式

3. **MATLAB版安装**：
   - 确保已安装MATLAB 2023b或更高版本
   - 解压下载的文件包到任意位置
   - 在MATLAB中，使用"设置路径"功能添加NNSR Toolbox文件夹
   - 在MATLAB命令窗口输入`NNSR_Launcher`启动程序

4. **首次启动设置**：
   - 首次启动时，系统将自动配置必要的环境参数
   - 根据提示完成初始化设置
   - 验证系统功能正常运行

## 3. 软件功能概述

NNSR Toolbox采用模块化架构设计，主要包含离线分析系统和在线分析系统两大功能模块。

### 3.1 架构设计

NNSR Toolbox分为三层架构：

1. **数据层**：负责数据读取、解析、存储和管理
2. **应用逻辑层**：集成核心算法，包括伪迹处理、特征提取等功能模块
3. **用户界面层**：提供直观的图形界面，包括离线分析和在线分析两个主要系统

### 3.2 功能组成

- **离线分析系统**
  - 自动分析模块
  - 手动分析模块
  
- **在线分析系统**
  - 在线分析模块
  - 体外闭环模块

### 3.3 基本工作流程

1. **数据获取**：从DBS设备获取原始LFP数据
2. **数据预处理**：伪迹识别与去除
3. **特征提取**：计算时域、频域等特征
4. **结果分析**：数据可视化与结果解读
5. **报告生成**：输出标准化分析报告

## 4. 离线分析系统

离线分析系统是NNSR Toolbox的核心组件之一，用于对已采集的DBS-LFP数据进行处理与分析。系统分为自动分析和手动分析两个模块，满足不同的分析需求。

### 4.1 自动分析模块

自动分析模块提供一键式数据处理功能，特别适合大批量数据的快速处理与筛查。

#### 4.1.1 启动与界面

1. 在NNSR主界面选择"自动分析"选项卡或点击对应按钮
2. 界面主要包含：数据导入区、伪迹处理区、特征提取区、结果显示区

![自动分析界面示意图](placeholder_for_auto_analysis_ui.png)

#### 4.1.2 数据导入

1. 点击"导入数据"按钮
2. 在弹出的文件选择对话框中，选择需要分析的数据文件
   - 支持.json和.data格式（DBS设备原始数据）
   - 支持.txt和.csv等通用格式
3. 导入后，系统自动显示数据基本信息：
   - 采样率
   - 通道数
   - 记录时长
   - 数据总量

#### 4.1.3 自动伪迹处理

1. 在"伪迹处理"区域设置参数：
   - 处理算法：自动/高级/定制
   - 处理强度：低/中/高
   - 特殊伪迹选项：心电/刺激/体动
   
2. 点击"开始处理"按钮
3. 系统自动执行以下步骤：
   - 基于深度学习算法自动识别伪迹类型
   - 基线漂移去除（使用2阶巴特沃斯高通滤波）
   - 心电伪迹去除（使用模板匹配法）
   - 电脉冲伪迹去除（使用自适应滤波）
   - 体动伪迹排除（使用自动片段选择）
   
4. 处理完成后，系统显示：
   - 伪迹去除前后对比图
   - 检测到的伪迹统计信息
   - 有效数据比例

#### 4.1.4 特征提取

1. 在"特征提取"区域选择需要的特征类型：
   - 时域特征：信号振幅、过零率等
   - 频域特征：特定频带（如β波、γ波）功率
   - 时频特征：能量随时间变化的动态特性
   - 时相特征：相位耦合与同步分析
   
2. 设置分析参数：
   - 窗口长度：一般为1-10秒
   - 窗口重叠率：一般为50%-75%
   - 感兴趣频段：如β波(13-30Hz)
   
3. 点击"计算特征"按钮
4. 系统自动计算并显示所选特征

#### 4.1.5 结果导出

1. 点击"结果导出"按钮
2. 选择导出格式：
   - PDF报告（含图形和数据表）
   - Excel表格（详细数据）
   - .M文件（MATLAB格式）
   - .TXT文件（纯文本格式）
   
3. 设置导出文件名和保存路径
4. 点击"确认导出"完成导出

### 4.2 手动分析模块

手动分析模块提供更灵活的分析选项，适合需要精细控制和专业调整的场景。

#### 4.2.1 启动与界面

1. 在NNSR主界面选择"手动分析"选项卡
2. 界面分为数据浏览区、处理工具区、参数设置区和结果显示区

![手动分析界面](placeholder_for_manual_analysis_ui.png)

#### 4.2.2 数据导入与预览

1. 点击"导入数据"按钮选择数据文件
2. 导入后，可在数据浏览区查看原始信号
3. 使用缩放、平移等工具调整视图
4. 可选择特定时间段进行分析

#### 4.2.3 伪迹处理

手动分析模块提供多种灵活的伪迹处理方法：

**基线漂移处理**：
1. 选择"基线漂移"标签页
2. 选择处理方法：
   - 高通滤波：设置截止频率（一般0.5-2Hz）
   - 多项式拟合：设置拟合阶数（一般3-5阶）
3. 点击"应用"查看效果，满意后点击"确认"

**心电伪迹处理**：
1. 选择"心电伪迹"标签页
2. 选择处理方法：
   - 模板匹配法：设置模板长度、相关阈值
   - 自适应滤波：设置滤波参数
3. 点击"应用"查看效果，满意后点击"确认"

**电脉冲伪迹处理**：
1. 选择"电脉冲伪迹"标签页
2. 选择处理方法：
   - 模板去除：适用于稳定波形伪迹
   - 自适应滤波器：适用于变化的刺激伪迹
3. 设置相关参数
4. 点击"应用"查看效果，满意后点击"确认"

**体动伪迹处理**：
1. 选择"体动伪迹"标签页
2. 系统显示自动检测的体动片段
3. 可手动调整选择范围
4. 点击"排除选中区域"或"仅保留选中区域"

#### 4.2.4 特征提取与分析

1. 在处理完伪迹后，点击"特征分析"标签
2. 选择需要分析的特征类型：
   - 时域特征
   - 频域特征
   - 时频特征
   - 时相特征
   
3. 根据需要设置分析参数
4. 点击"计算"按钮
5. 系统显示计算结果和可视化图形

#### 4.2.5 批量处理功能

1. 点击"批量处理"按钮
2. 在弹出窗口中添加多个数据文件
3. 设置统一的处理参数
4. 点击"开始批处理"
5. 系统逐个处理文件并生成汇总报告
6. 批处理完成后可查看每个文件的处理结果

### 4.3 数据管理功能

#### 4.3.1 数据库管理

1. 点击"数据管理"按钮
2. 系统显示已分析数据的列表
3. 可按日期、患者ID等条件筛选
4. 支持数据备份和恢复功能

#### 4.3.2 历史记录查看

1. 点击"历史记录"按钮
2. 查看之前的分析记录
3. 可重新加载历史分析设置
4. 支持对比不同时间点的分析结果

## 5. 在线分析系统

在线分析系统用于实时处理来自DBS设备的数据，支持实时特征提取和基于特征的反馈控制，为脑机交互研究提供技术支持。

### 5.1 在线分析模块

#### 5.1.1 连接设置

1. 在NNSR主界面选择"在线分析"选项卡
2. 点击"连接设置"按钮
3. 在弹出的设置窗口中配置连接参数：
   - 连接模式：串口/TCP
   - 通信参数：
     - 串口：COM端口、波特率(一般115200)
     - TCP：IP地址、端口号
   - 数据协议：选择对应设备的协议类型
   - 安全参数：设置连接超时、心跳间隔等
4. 点击"测试连接"验证设置
5. 连接成功后点击"确认"保存设置

![连接设置界面](placeholder_for_connection_ui.png)

#### 5.1.2 实时数据采集

1. 设置实时采集参数：
   - 采样率：通常为250Hz或500Hz
   - 缓冲区大小：根据系统性能调整
   - 通道选择：选择需要分析的通道
   
2. 点击"开始采集"按钮
3. 系统开始实时显示传入的LFP信号
4. 使用"暂停"/"继续"按钮控制采集
5. 点击"停止采集"结束采集过程

#### 5.1.3 实时处理与特征提取

1. 在"实时处理"区域设置参数：
   - 窗口长度：建议200ms-10s
   - 窗口重叠率：建议10%-90%
   - 滤波设置：高通滤波、陷波滤波等
   
2. 在"特征提取"区域选择需要提取的特征：
   - 时域特征：振幅、希尔伯特包络等
   - 频域特征：功率谱密度、频带能量等
   - 时频特征：短时傅里叶变换等
   
3. 点击"开始处理"按钮
4. 系统实时显示：
   - 处理后的信号波形
   - 选定特征的数值变化
   - 特征趋势图

#### 5.1.4 数据记录与事件标记

1. 点击"开始记录"保存实时数据
2. 在采集过程中，可使用"添加标记"按钮:
   - 标记重要事件（如任务开始/结束）
   - 记录观察到的行为变化
   - 记录参数调整时间点
   
3. 添加标记时可输入标记描述
4. 记录完成后点击"停止记录"
5. 系统自动保存数据和标记信息
6. 可将记录的数据导出或在离线分析系统中打开

### 5.2 体外闭环模块

体外闭环模块用于研究基于LFP特征的脑机交互与神经反馈，支持根据实时特征调整DBS参数。

#### 5.2.1 安全协议设置

1. 点击"安全协议"选项卡
2. 设置参数约束范围：
   - 频率范围：如60-180Hz
   - 幅度范围：如0.5-3.5mA
   - 脉宽范围：如60-90μs
   
3. 设置安全策略：
   - 参数变化速率限制
   - 最大调整步长
   - 安全监测阈值
   
4. 点击"保存安全设置"

![安全协议设置](placeholder_for_safety_protocol.png)

#### 5.2.2 闭环规则配置

1. 点击"闭环规则"选项卡
2. 创建新规则：
   - 选择触发特征（如β波功率）
   - 设置条件（如大于/小于阈值）
   - 设置触发动作（如调整频率/幅度）
   - 设置调整参数（如步长、延迟）
   
3. 可创建多条规则并设置优先级
4. 使用规则验证工具检查规则冲突
5. 点击"保存规则"

#### 5.2.3 闭环模式运行

1. 确认连接状态和安全设置
2. 选择已配置的闭环规则集
3. 点击"启动闭环模式"
4. 系统实时显示：
   - 神经信号及提取的特征
   - 当前DBS参数设置
   - 闭环调整事件记录
   - 规则触发历史
   
5. 使用"暂停规则"按钮可临时暂停规则执行
6. 点击"停止"按钮结束闭环模式
7. 系统自动生成闭环实验报告

#### 5.2.4 结果分析与导出

1. 闭环实验结束后，系统提供：
   - 特征变化与参数调整的时间关联图
   - 规则触发统计分析
   - 关键事件时间线
   
2. 点击"导出报告"生成实验报告
3. 选择导出格式和内容
4. 设置文件名和保存路径

## 6. 应用场景

NNSR Toolbox适用于多种临床研究和科学探索场景，下面介绍三个典型应用案例。

### 6.1 伪迹处理与信号质量改善

**案例描述**：
处理植入G106RS设备的帕金森病患者的LFP数据，原始数据存在明显的刺激伪迹和心电伪迹。

**操作步骤**：
1. 使用离线分析系统的自动分析模块导入数据
2. 运行自动伪迹识别功能
3. 系统自动处理以下伪迹：
   - 在130Hz频率处的刺激伪迹
   - 时域信号中的心电伪迹
4. 处理后，信号振幅从超过5000μV减少至约±20μV
5. 功率谱密度和时频图显示伪迹得到显著缓解

**应用价值**：
此案例展示了NNSR Toolbox在复杂伪迹处理方面的有效性，为后续的特征分析提供了高质量的数据基础。

### 6.2 药物波动特征分析

**案例描述**：
监测帕金森病患者服药后的神经电生理特征变化，记录了约4小时20分钟的连续数据。

**操作步骤**：
1. 使用离线分析系统导入长时间记录数据
2. 执行以下处理步骤：
   - 数据段拼接与衔接
   - 基线漂移去除
   - 刺激伪迹去除
   - 时频分析与频带特征提取
3. 分析结果显示：
   - 服药后约0.5小时，β频带(13-30Hz)能量减少
   - γ频带(30-70Hz)能量增强
   - 药物"开期"的神经电生理特征明显
   - 服药约3小时后，频带能量逐渐回到基线水平

**应用价值**：
此案例展示了NNSR Toolbox在长时间数据批处理与分析方面的能力，揭示了药物对神经振荡特征的动态调制作用，为个性化神经调控研究提供支持。

### 6.3 实时特征提取与交互研究

**案例描述**：
使用在线分析系统研究DBS参数调整与神经信号特征变化的关系。

**操作步骤**：
1. 配置在线分析系统的连接设置
2. 设置实时处理参数：
   - 窗口长度1秒
   - 重叠率50%
3. 选择要监测的特征（β频带功率）
4. 在临床医师监督下进行参数调整实验：
   - 从最佳DBS参数设置开始
   - 逐步调低刺激参数
   - 实时监测神经特征变化
5. 实验结果显示：
   - 刺激参数调低后，β频带(13-30Hz)功率显著增强
   - 患者左侧肢体控制能力同步出现下降
   - 神经特征变化与症状表现高度一致

**应用价值**：
此案例验证了NNSR Toolbox在实时神经信号处理与特征分析方面的技术优势，展示了系统实时捕捉刺激-响应特征的能力，为开发基于神经特征的个性化治疗方案提供技术支持。

## 7. 常见问题与故障排除

### 7.1 安装问题

**问题**: 安装程序无法启动
**解决方案**:
- 确认操作系统满足最低要求
- 以管理员身份运行安装程序
- 暂时关闭杀毒软件

**问题**: 安装过程中出现"缺少组件"错误
**解决方案**:
- 下载并安装Microsoft Visual C++ Redistributable
- 更新操作系统至最新版本
- 从官方网站重新下载安装包

### 7.2 连接问题

**问题**: 无法建立与设备的连接
**解决方案**:
- 检查设备是否开启并处于配对模式
- 验证连接参数（COM端口/IP地址）是否正确
- 确认蓝牙设备是否正常工作
- 尝试重启设备和软件

**问题**: 连接频繁断开
**解决方案**:
- 检查设备电池电量
- 减少蓝牙干扰源
- 调整连接超时参数
- 更新设备固件

### 7.3 数据处理问题

**问题**: 伪迹无法有效去除
**解决方案**:
- 尝试使用手动分析模块的高级设置
- 调整伪迹处理参数
- 对特定伪迹类型使用专用处理方法
- 对严重污染的数据段进行手动排除

**问题**: 处理后数据出现失真
**解决方案**:
- 检查滤波器参数设置
- 减小处理强度
- 使用保留信号特征的替代算法
- 比较多种处理方法的结果

### 7.4 性能问题

**问题**: 软件运行缓慢
**解决方案**:
- 关闭不必要的后台程序
- 减少处理数据的长度
- 降低分析参数的复杂度
- 增加系统内存

**问题**: 在线分析模式延迟过高
**解决方案**:
- 使用TCP连接代替串口连接
- 减小窗口长度和重叠率
- 减少同时计算的特征数量
- 优化计算机性能设置

### 7.5 结果导出问题

**问题**: 无法生成PDF报告
**解决方案**:
- 安装PDF打印驱动
- 检查磁盘空间
- 减少报告中的图形数量
- 分段生成报告

## 8. 技术支持

### 8.1 更新与维护

NNSR Toolbox会定期发布更新，包括功能改进和问题修复。请定期访问官方网站检查更新。

更新方法：
1. 在软件主界面点击"检查更新"
2. 如有更新，按照提示完成下载和安装
3. 更新完成后，重启软件

### 8.2 联系方式

如遇到无法解决的问题，请通过以下方式联系技术支持团队：

- **电子邮件**: support@nnsr-toolbox.org
- **技术论坛**: https://forum.nnsr-toolbox.org
- **GitHub**: https://github.com/nnsr-toolbox

### 8.3 反馈与建议

我们欢迎用户提供反馈和建议，以帮助改进NNSR Toolbox。请通过以下方式提交：

1. 在软件中使用"提交反馈"功能
2. 发送邮件至feedback@nnsr-toolbox.org
3. 在GitHub项目页面提交issue或pull request

---

© 2025 NERCN NeuroSignal Research Team. All rights reserved.
